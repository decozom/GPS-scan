<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Field Timer</title>

<!-- フォント（斜線入り0） -->
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@600&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #fff;
  font-family: 'Roboto Mono', monospace;
  height: 100%;
}

#app {
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ===== メイン画面 ===== */
#main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

#version {
  text-align: right;
  font-size: 12px;
  padding: 4px 8px;
  opacity: 0.6;
}

/* 擬似マップ */
#map {
  flex: 1;
  margin: 8px;
  border: 2px solid #444;
  background:
    repeating-linear-gradient(
      45deg,
      #222,
      #222 10px,
      #111 10px,
      #111 20px
    );
}

/* タイマー表示 */
#timer {
  text-align: center;
  font-size: 56px;
  padding: 10px 0;
  font-variant-numeric: slashed-zero;
  white-space: nowrap;
}

/* 赤表示 */
.red {
  color: red;
}

/* 点滅 */
.blink {
  animation: blink 1s step-start infinite;
}
@keyframes blink {
  50% { opacity: 0; }
}

/* ボタン */
#buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  padding: 8px;
}

button {
  font-size: 16px;
  padding: 14px;
  background: #222;
  color: #fff;
  border: 1px solid #555;
  border-radius: 6px;
}

/* ===== 設定画面 ===== */
#settings {
  display: none;
  flex: 1;
  padding: 20px;
}

.settings-btn {
  width: 100%;
  margin-bottom: 12px;
}
</style>
</head>

<body>
<div id="app">

  <!-- メイン画面 -->
  <div id="main">
    <div id="version">v0.0</div>

    <div id="map"></div>

    <div id="timer">00:00</div>

    <div id="buttons">
      <button onclick="toggleStart()">START</button>
      <button onclick="resetTimer()">RESET</button>
      <button onclick="scan()">SCAN</button>
      <button onclick="openSettings()">SET</button>
    </div>
  </div>

  <!-- 設定画面 -->
  <div id="settings">
    <button class="settings-btn" onclick="backToMain()">メイン画面に戻る</button>
    <button class="settings-btn" onclick="setTimer()">タイマーセット</button>
  </div>

</div>

<script>
let timerInterval = null;
let remainingMs = 0;
let setTimeMs = 0;
let running = false;

const timerEl = document.getElementById("timer");

function formatTime(ms) {
  if (ms <= 0) return "00:00";

  const totalSec = Math.floor(ms / 1000);
  const min = Math.floor(totalSec / 60);
  const sec = totalSec % 60;

  if (ms <= 180000) {
    const cs = Math.floor((ms % 1000) / 10);
    return `${String(min).padStart(2,"0")}:${String(sec).padStart(2,"0")}:${String(cs).padStart(2,"0")}`;
  } else {
    return `${String(min).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
  }
}

function updateDisplay() {
  timerEl.textContent = formatTime(remainingMs);

  timerEl.classList.remove("red","blink");

  if (remainingMs <= 180000 && remainingMs > 0) {
    timerEl.classList.add("red");
  }
  if (remainingMs <= 30000 && remainingMs > 0) {
    timerEl.classList.add("blink");
  }
}

function toggleStart() {
  if (!running) {
    if (remainingMs <= 0) remainingMs = setTimeMs;
    running = true;
    timerInterval = setInterval(() => {
      remainingMs -= 10;
      if (remainingMs <= 0) {
        remainingMs = 0;
        stopTimer();
      }
      updateDisplay();
    }, 10);
  } else {
    stopTimer();
  }
}

function stopTimer() {
  running = false;
  clearInterval(timerInterval);
}

function resetTimer() {
  stopTimer();
  remainingMs = setTimeMs;
  updateDisplay();
}

function scan() {
  alert("SCAN（ダミー）");
}

function openSettings() {
  document.getElementById("main").style.display = "none";
  document.getElementById("settings").style.display = "block";
}

function backToMain() {
  document.getElementById("settings").style.display = "none";
  document.getElementById("main").style.display = "flex";
}

function setTimer() {
  const min = prompt("分を入力（初期値0）", "0");
  if (min === null) return;
  const m = Math.max(0, parseInt(min) || 0);
  setTimeMs = m * 60 * 1000;
  remainingMs = setTimeMs;
  updateDisplay();
  backToMain();
}

updateDisplay();
</script>
</body>
</html>