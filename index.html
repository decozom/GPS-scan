<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Field Timer</title>

<style>
body {
  background: black;
  color: white;
  font-family: system-ui, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}

/* ===== 画面切り替え ===== */
.screen {
  display: none;
}
.screen.active {
  display: block;
}

/* ===== タイマー表示 ===== */
#timerDisplay {
  font-size: 48px;
  margin: 20px 0;
  font-weight: bold;
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  font-variant-numeric: tabular-nums;
  width: 10ch;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}

/* 点滅 */
@keyframes blink {
  0% { opacity: 1; }
  50% { opacity: 0.2; }
  100% { opacity: 1; }
}
.blink {
  animation: blink 1s infinite;
}

/* ボタン */
button {
  font-size: 16px;
  margin: 5px;
  padding: 10px 15px;
}

#versionDisplay {
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  font-variant-numeric: tabular-nums;
  opacity: 0.6;
  margin-top: 20px;
}
</style>
</head>

<body>

<!-- ===== メイン画面 ===== -->
<div id="mainScreen" class="screen active">
  <h2>フィールド選択</h2>
  <button onclick="openField()">フィールドへ</button>
  <div id="versionDisplay">v0.0</div>
</div>

<!-- ===== フィールド画面 ===== -->
<div id="fieldScreen" class="screen">
  <div id="timerDisplay">00:00</div>

  <button onclick="toggleTimer()">スタート / ストップ</button>
  <button onclick="resetTimer()">リセット</button>
  <button onclick="scan()">スキャン</button>
  <button onclick="openSettings()">設定</button>
</div>

<!-- ===== 設定画面 ===== -->
<div id="settingScreen" class="screen">
  <h3>設定</h3>

  <button onclick="openTimerSetting()">タイマーセット</button>
  <br><br>
  <button onclick="backToMain()">メイン画面に戻る</button>
</div>

<!-- ===== タイマー設定画面 ===== -->
<div id="timerSettingScreen" class="screen">
  <h3>タイマー設定（分）</h3>

  <!-- ★ これが input。最初から value="0" -->
  <input type="number" id="minuteInput" min="0" value="0">
  <br><br>

  <button onclick="setTimer()">設定</button>
  <button onclick="openSettings()">戻る</button>
</div>

<script>
let timerId = null;
let remainingMs = 0;
let running = false;

/* ===== 画面切り替え ===== */
function show(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
}

function openField() { show('fieldScreen'); }
function openSettings() { show('settingScreen'); }
function backToMain() { show('mainScreen'); }
function openTimerSetting() { show('timerSettingScreen'); }

/* ===== タイマー ===== */
function toggleTimer() {
  if (running) {
    clearInterval(timerId);
    running = false;
    return;
  }
  if (remainingMs <= 0) return;

  running = true;
  const start = Date.now();
  const startRemain = remainingMs;

  timerId = setInterval(() => {
    remainingMs = startRemain - (Date.now() - start);
    if (remainingMs <= 0) {
      remainingMs = 0;
      clearInterval(timerId);
      running = false;
    }
    updateDisplay();
  }, 50);
}

function resetTimer() {
  clearInterval(timerId);
  running = false;
  remainingMs = 0;
  updateDisplay();
}

function setTimer() {
  const min = Number(document.getElementById('minuteInput').value);
  remainingMs = min * 60 * 1000;
  updateDisplay();
  show('fieldScreen');
}

function updateDisplay() {
  const d = document.getElementById('timerDisplay');
  d.classList.remove('blink');
  d.style.color = 'white';

  if (remainingMs <= 0) {
    d.textContent = '00:00';
    return;
  }

  const totalSec = remainingMs / 1000;
  const min = Math.floor(totalSec / 60);
  const sec = Math.floor(totalSec % 60);
  const cs = Math.floor((remainingMs % 1000) / 10);

  if (remainingMs <= 30000) {
    d.style.color = 'red';
    d.classList.add('blink');
  }

  if (remainingMs <= 180000) {
    d.textContent =
      String(min).padStart(2, '0') + ':' +
      String(sec).padStart(2, '0') + ':' +
      String(cs).padStart(2, '0');
  } else {
    d.textContent =
      String(min).padStart(2, '0') + ':' +
      String(sec).padStart(2, '0');
  }
}

/* ===== ダミー ===== */
function scan() {
  alert('スキャン（仮）');
}
</script>

</body>
</html>